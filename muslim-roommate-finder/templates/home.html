{% extends "base.html" %}

{% block title %}Home - Muslim Roommate Finder{% endblock %}

{% block content %}
  <!-- Quick Filter Buttons -->
  <div class="mb-3">
    <div class="btn-group" role="group">
      <a href="{% url 'home' %}" class="btn btn-outline-primary {% if not preference_filter %}active{% endif %}">
        Show All
      </a>
      <a href="?preference=offering_room" class="btn btn-outline-success {% if preference_filter == 'offering_room' %}active{% endif %}">
        üè† Available Rooms
      </a>
      <a href="?preference=looking_for_room" class="btn btn-outline-info {% if preference_filter == 'looking_for_room' %}active{% endif %}">
        üë• Looking for Rooms
      </a>
    </div>
  </div>

  <!-- Search + Filters -->
  <div class="card mb-4">
    <div class="card-body">
      <form method="get" class="row g-3">
        <div class="col-md-4">
          <label for="search" class="form-label">Search</label>
          <input type="text" class="form-control" id="search" name="search"
                 value="{{ search_query }}" placeholder="Search by name, city, or bio...">
        </div>
        <div class="col-md-2">
          <label for="city" class="form-label">City</label>
          <select class="form-select" id="city" name="city">
            <option value="">All Cities</option>
            {% for city in cities %}
              <option value="{{ city }}" {% if city_filter == city %}selected{% endif %}>{{ city }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2">
          <label for="gender" class="form-label">Gender</label>
          <select class="form-select" id="gender" name="gender">
            <option value="">All Genders</option>
            <option value="M" {% if gender_filter == 'M' %}selected{% endif %}>Male</option>
            <option value="F" {% if gender_filter == 'F' %}selected{% endif %}>Female</option>
          </select>
        </div>
        <div class="col-md-2">
          <label for="preference" class="form-label">Preference</label>
          <select class="form-select" id="preference" name="preference">
            <option value="">All Preferences</option>
            <option value="halal_kitchen" {% if preference_filter == 'halal_kitchen' %}selected{% endif %}>Halal Kitchen</option>
            <option value="prayer_friendly" {% if preference_filter == 'prayer_friendly' %}selected{% endif %}>Prayer Friendly</option>
            <option value="guests_allowed" {% if preference_filter == 'guests_allowed' %}selected{% endif %}>Guests Allowed</option>
            <option value="looking_for_room" {% if preference_filter == 'looking_for_room' %}selected{% endif %}>Looking for Room</option>
            <option value="offering_room" {% if preference_filter == 'offering_room' %}selected{% endif %}>Offering Room</option>
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button type="submit" class="btn btn-primary w-100">Search</button>
        </div>
      </form>
      {% if search_query or city_filter or gender_filter or preference_filter %}
        <div class="mt-3">
          <a href="{% url 'home' %}" class="btn btn-outline-secondary btn-sm">Clear All Filters</a>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Available Rooms -->
  {% if available_rooms %}
    <h3 class="text-success mb-3">üè† Available Rooms ({{ rooms_count }})</h3>
    <div class="row">
      {% for room in available_rooms %}
        <div class="col-md-4 mb-4">
          <a href="{% url 'room_detail' room.id %}" class="text-decoration-none">
            <div class="card h-100 border-success">
              <div class="card-header bg-success text-white">{{ room.title }}</div>
              <div class="card-body">
                <h6 class="text-muted">{{ room.city }}{% if room.neighborhood %} ‚Ä¢ {{ room.neighborhood }}{% endif %}</h6>
                {% if room.rent %}<p><strong>Rent:</strong> ${{ room.rent }}</p>{% endif %}
                {% if room.description %}<p>{{ room.description }}</p>{% endif %}
                <small class="text-muted"><strong>Contact:</strong> {{ room.contact_email }}</small>
              </div>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- People Looking for Rooms -->
  {% if profiles %}
    <h3 class="text-primary mb-3">üë• People Looking for Rooms ({{ profile_count }})</h3>
    <div class="row">
      {% for profile in profiles %}
        <div class="col-md-4 mb-4">
          <a href="{{ profile.get_absolute_url }}" class="text-decoration-none">
            <div class="card h-100 border-primary">
              <div class="card-header bg-primary text-white">{{ profile.name }}, {{ profile.age }}</div>
              <div class="card-body">
                <h6 class="text-muted">{{ profile.city }} | {{ profile.get_gender_display }}</h6>
                {% if profile.bio %}<p>{{ profile.bio }}</p>{% endif %}
                <small>
                    <strong>Contact:</strong>{{ profile.contact_email}}
                </small>
            </div>
        </div>
    </a>
</div>
{% endfor %}
</div>
{% endif %}
{% endblock %}